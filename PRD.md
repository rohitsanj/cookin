# Cookin — WhatsApp Cooking Habit Chatbot

## Problem

People want to cook at home more but fail because of poor planning: they forget to buy groceries, don't decide what to cook until they're already hungry, and lose momentum after a few days. Existing meal-planning apps require yet another app to check. WhatsApp is already open all day.

## Solution

A WhatsApp chatbot that proactively manages the full loop — meal planning, grocery shopping, and cooking reminders — on a user-configured schedule. The bot reaches out to the user (not the other way around), making it a push-based habit system rather than a pull-based tool.

---

## Core Concepts

### User Profile

Each user has a persistent profile containing:

- **Cuisine preferences** — e.g., Indian, Italian, Mexican, quick meals, vegetarian
- **Dietary restrictions** — allergies, intolerances, foods to avoid
- **Household size** — number of servings to plan for
- **Cooking skill level** — beginner / intermediate / advanced (affects recipe complexity)
- **Schedule** — which days to cook, which days to buy groceries, preferred reminder times

### Kitchen Inventory

A running ledger of what the user has at home:

- Staples (oil, salt, rice, spices) — assumed to persist across weeks unless the user says otherwise
- Perishables (vegetables, meat, dairy) — decay over time, bot can prompt "do you still have X?"
- Updated via natural conversation: "I bought eggs and tomatoes" or "I'm out of onions"
- **Weekly confirmation**: Before generating each meal plan, bot sends the current inventory as a numbered checklist and asks the user to reply with the numbers of items they still have (see Inventory Confirmation flow below). This keeps the inventory honest without requiring the user to remember everything.

### Recipe Book

A personal collection of recipes the user has tried and liked:

- When a user rates a meal positively (or explicitly says "save this"), the recipe — including any modifications they made — is persisted to their recipe book.
- The LLM generates all recipes from scratch based on user preferences. There is no external recipe database.
- Saved recipes can be re-suggested in future weeks. The bot will favor saved recipes the user rated highly, mixed with new suggestions for variety.
- Modifications are first-class: if the user says "I subbed yogurt for cream and it was better", the saved version reflects that change.

### Meal Plan

A weekly plan generated by the bot and confirmed by the user:

- Covers only the days the user wants to cook
- Each meal includes a recipe name, ingredient list, and estimated cook time
- Respects cuisine preferences, dietary restrictions, inventory, and variety (no repeats within a week)
- Draws from a mix of saved recipes (from the user's recipe book) and new LLM-generated recipes

---

## User Flows

### 1. Onboarding (First Interaction)

Trigger: User sends first message to the bot (or is added by an admin).

The bot collects via conversational Q&A:

1. "What cuisines do you enjoy?" (free text, multi-select)
2. "Any dietary restrictions?" (free text or "none")
3. "How many people are you cooking for?"
4. "How would you rate your cooking skills?" (beginner / intermediate / advanced)
5. "Which days of the week do you want to cook?" (e.g., Mon, Wed, Fri, Sun)
6. "Which day do you want your grocery list?" (e.g., Saturday morning)
7. "What time should I remind you to start cooking?" (e.g., 5:30 PM)
8. "Do you have any staples already at home?" (free text list)
9. "How many messages from me per day is okay? (e.g., 2-3, or just the essentials)" — sets max_messages_per_day

Bot confirms the profile back to the user and saves it.

### 2. Inventory Confirmation (Scheduled — Before Meal Planning)

Trigger: Cron fires on grocery day, slightly before meal planning (or as step 1 of the same flow).

WhatsApp does not support multi-select checkboxes. Instead, the bot sends a numbered text checklist:

```
Before I plan this week, let me check what you have.

Here's what I think is in your kitchen:
1. Rice
2. Olive oil
3. Garlic
4. Onions
5. Soy sauce
6. Eggs (bought 4 days ago)
7. Chicken thighs (bought 4 days ago)
8. Spinach (bought 5 days ago — still good?)

Reply with the numbers you still have, e.g. "1,2,3,5"
Or reply "all" / "none"
```

The user replies with numbers. Bot updates inventory (removes unchecked items), then proceeds to meal planning.

### 3. Weekly Meal Planning (Scheduled — Grocery Day)

Trigger: Fires immediately after inventory confirmation.

1. Bot sends a proposed meal plan for the upcoming cooking days.
   ```
   Here's your plan for this week:

   Mon — Chicken tikka masala (45 min)
   Wed — Pasta aglio e olio (20 min)
   Fri — Black bean tacos (30 min)
   Sun — Dal makhani with rice (50 min)

   Want to swap anything?
   ```
2. User can:
   - Accept as-is ("looks good")
   - Swap a specific meal ("swap Monday for something quicker")
   - Reject and ask for a full re-roll ("give me new options")
   - Add/remove a cooking day for this week only ("skip Friday this week")
3. Once confirmed, bot generates a **grocery list** based on:
   - Ingredients needed minus current kitchen inventory
   - Grouped by store section (produce, dairy, protein, pantry)
4. Bot sends the grocery list.
5. After expected shopping time, bot follows up: "Did you get everything on the list?" User can report what they bought, and inventory is updated.

### 4. Cooking Reminders (Scheduled — Cook Days)

Trigger: Cron fires at the user's configured reminder time on cook days.

1. Bot sends a reminder with the recipe:
   ```
   Time to cook! Tonight: Chicken tikka masala

   Ingredients:
   - 500g chicken thigh (you have this)
   - 1 can tomatoes (you have this)
   - 2 tbsp tikka paste
   - 200ml cream
   - Rice

   Steps:
   1. Marinate chicken in tikka paste, 15 min
   2. Sear chicken in hot pan
   3. Add tomatoes and cream, simmer 20 min
   4. Serve over rice

   Need to adjust anything?
   ```
2. User can:
   - Confirm ("on it")
   - Ask to postpone ("push to tomorrow")
   - Skip ("not cooking tonight")
   - Ask questions ("can I sub yogurt for cream?")
3. After estimated cook time, bot checks in: "How did it go? Rate 1-5 or tell me what you'd change." User feedback is logged. If rated 4+, bot asks "Want me to save this to your recipe book?" If the user made modifications during cooking ("I used yogurt instead of cream"), those are saved as the canonical version.

### 5. Ad-Hoc Interactions (User-Initiated, Anytime)

Users can message the bot anytime to:

- **Update inventory**: "I bought milk and eggs" / "I'm out of garlic"
- **Change preferences**: "I want to try more Japanese food" / "I'm going vegetarian this month"
- **Adjust schedule**: "Move my grocery day to Friday" / "Remind me at 6 PM instead"
- **Adjust message frequency**: "Send me fewer messages" / "I'm fine with more check-ins"
- **Ask for a recipe**: "What can I make with what I have?"
- **Log a meal**: "I cooked pasta tonight" (updates inventory by deducting ingredients)
- **View current plan**: "What's my plan this week?"
- **Rate / save a recipe**: "That was great, save it" / "4 out of 5" — saves to recipe book with rating
- **Modify a saved recipe**: "For the tikka masala, next time use yogurt instead of cream" — updates the saved version
- **Browse saved recipes**: "Show me my saved recipes" / "What Indian recipes have I saved?"

---

## Data Model

### User
| Field | Type | Example |
|---|---|---|
| phone_number | string (PK) | +1234567890 |
| name | string | Rohit |
| cuisine_preferences | string[] | ["Indian", "Italian", "Mexican"] |
| dietary_restrictions | string[] | ["no shellfish"] |
| household_size | int | 2 |
| skill_level | enum | intermediate |
| cook_days | string[] | ["Monday", "Wednesday", "Friday", "Sunday"] |
| grocery_day | string | Saturday |
| grocery_time | string | 09:00 |
| cook_reminder_time | string | 17:30 |
| timezone | string | America/Los_Angeles |
| max_messages_per_day | int | 3 |

### InventoryItem
| Field | Type | Example |
|---|---|---|
| user_phone | string (FK) | +1234567890 |
| item_name | string | eggs |
| category | enum | protein |
| quantity | string (nullable) | 12 |
| is_staple | bool | false |
| last_updated | timestamp | 2025-01-15T10:00:00Z |

### SavedRecipe
| Field | Type | Example |
|---|---|---|
| id | uuid (PK) | ... |
| user_phone | string (FK) | +1234567890 |
| recipe_name | string | Chicken tikka masala |
| original_recipe_steps | text | ... (as first generated) |
| modified_recipe_steps | text (nullable) | ... (with user's tweaks) |
| ingredients | jsonb | [{name, qty, unit}] |
| cook_time_min | int | 45 |
| cuisine | string | Indian |
| user_rating | int | 5 |
| notes | text (nullable) | "subbed yogurt for cream, much better" |
| times_cooked | int | 3 |
| last_cooked | date | 2025-02-01 |
| created_at | timestamp | ... |

### MealPlan
| Field | Type | Example |
|---|---|---|
| id | uuid (PK) | ... |
| user_phone | string (FK) | +1234567890 |
| week_start | date | 2025-01-13 |
| status | enum | confirmed |

### PlannedMeal
| Field | Type | Example |
|---|---|---|
| id | uuid (PK) | ... |
| meal_plan_id | uuid (FK) | ... |
| day | string | Monday |
| recipe_name | string | Chicken tikka masala |
| recipe_steps | text | ... |
| ingredients | jsonb | [{name, qty, unit, in_inventory}] |
| cook_time_min | int | 45 |
| status | enum | pending / cooked / skipped |
| user_rating | int (nullable) | 4 |

### GroceryList
| Field | Type | Example |
|---|---|---|
| id | uuid (PK) | ... |
| meal_plan_id | uuid (FK) | ... |
| items | jsonb | [{name, qty, unit, section}] |
| sent_at | timestamp | ... |
| fulfilled | bool | false |

---

## Technical Architecture

### Components

1. **WhatsApp Integration** — Twilio WhatsApp API. Twilio provides a WhatsApp sandbox for development and purchased numbers for production. Pricing is per-message (Twilio fee + WhatsApp fee). Simpler to set up than Meta Cloud API directly.
2. **Message Handler** — Receives inbound webhooks, routes to conversation logic.
3. **LLM Layer** — Vendor-agnostic. The server operator configures their preferred LLM provider via environment variables (provider name, API key, model ID). Supported providers: OpenAI, Anthropic, Google Gemini, or any OpenAI-compatible API. The LLM interprets free-text user messages, generates meal plans and recipes, handles substitutions and Q&A. System prompt includes user profile and inventory as context. All LLM calls go through a thin adapter interface so swapping providers requires zero code changes.
4. **Scheduler** — Cron-based job runner that triggers outbound messages (grocery lists, cook reminders) based on each user's configured schedule.
5. **Database** — SQLite (via better-sqlite3) for user profiles, inventory, meal plans, grocery lists. File-based, zero setup, ideal for single-user MVP. Can migrate to PostgreSQL later if needed.
6. **Server** — TypeScript + Node.js + Express API server handling webhooks and cron triggers.

### LLM Configuration

Set via environment variables at deploy time — not per-user, since this is a single-user MVP:

```
LLM_PROVIDER=openai          # openai | anthropic | google | openai-compatible
LLM_API_KEY=sk-...
LLM_MODEL=gpt-4o             # model ID (provider-specific)
LLM_BASE_URL=                 # optional, for openai-compatible endpoints (e.g. Ollama, Together, Groq)
```

The server exposes a single `llm.chat(messages, systemPrompt)` interface. Provider-specific adapters translate this to the appropriate API format. Adding a new provider means adding one adapter file — no other code changes.

### High-Level Flow

```
WhatsApp User
    |
    v
Twilio Webhook ----------> Message Handler --> LLM (configurable)
                                |                |
                                v                v
                           Database        Response to User
                                ^
                                |
                         Scheduler (cron)
                                |
                                v
                        Outbound Messages --> WhatsApp User
```

---

## Scope & Phasing

### Phase 1 — MVP

- Single-user support (just you)
- Onboarding flow
- Weekly meal plan generation + grocery list via LLM
- Inventory confirmation checklist before each plan
- Scheduled grocery list and cook reminders
- Basic inventory tracking (user tells bot what they have)
- Conversation for swapping meals and adjusting plans
- Recipe saving — save liked recipes with modifications to personal recipe book
- Configurable message frequency

### Phase 2 — Refinement

- Inventory auto-deduction when a meal is marked cooked
- Perishable expiry prompts ("you bought spinach 5 days ago — still have it?")
- Meal history tracking — avoid repeating recent meals, favor saved recipes
- Recipe scaling based on household size
- WhatsApp interactive messages (list buttons for single-select choices where applicable)

### Phase 3 — Multi-User & Polish

- Multi-user support with isolated profiles
- Shared household plans (two people on same plan)
- Cost estimation per meal / per week
- Grocery store integration (Instacart, etc.)
- Photo-based inventory updates (snap your fridge)

---

## Resolved Decisions

1. **Recipe source** — LLM generates all recipes from scratch. No external recipe database. Recipes the user likes (with any modifications) are saved to their personal recipe book and re-suggested in future weeks.
2. **Inventory trust** — Low trust. Bot sends a numbered checklist of current inventory before each weekly plan and asks the user to confirm what they still have by replying with item numbers. WhatsApp doesn't support native multi-select, so we use a text-based numbered list pattern.
3. **Message frequency** — User-configurable via `max_messages_per_day` (set during onboarding, adjustable anytime). Default is 3. Bot tracks daily outbound count per user and suppresses non-critical messages when the cap is reached.
4. **WhatsApp API** — Twilio WhatsApp API. Per-message pricing (Twilio fee + WhatsApp fee). Simpler to set up than Meta Cloud API directly — provides a sandbox for development and handles the WhatsApp Business API complexity. Bot-initiated messages require the user to have messaged within the last 24 hours (sandbox) or use pre-approved templates (production).

## Remaining Open Questions

1. **Twilio sandbox vs. production** — The Twilio WhatsApp sandbox is free for development but requires users to opt in with a code. For production, a Twilio-registered WhatsApp number with pre-approved message templates is needed.
2. **Recipe quality** — How do we handle cases where the LLM generates a bad recipe? Initial answer: user rates it low, it's never suggested again, and the bot learns from the feedback in future prompts.
